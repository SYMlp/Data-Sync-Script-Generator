# 📏 MySQL 脚本生成平台 - 开发质量量规 (Project Development Rubric)

> **生效日期**: 2025-11-24
> **适用范围**: 所有 Python 后端代码、Streamlit 前端逻辑及 SQL 生成模块。
> **执行人**: AI Coding 量规专家 / Tech Lead

## 1. 核心业务逻辑：SQL 生成 (Core: SQL Generation)

此维度关注 `src/generator/sql_generator.py` 及其相关逻辑。这是本工具的“心脏”。

| 评分 | 描述 | 关键特征 (Key Indicators) |
| :--- | :--- | :--- |
| **🟢 卓越 (4pt)** | **工业级健壮性** | 1. 生成的存储过程包含完善的 `DECLARE EXIT HANDLER` 异常捕获。<br>2. 实现了分批次提交 (`COMMIT`)，避免大事务锁表。<br>3. 自动处理了 MySQL 关键字转义（如表名为 `order`）。 |
| **🔵 达标 (3pt)** | **逻辑正确** | 1. 游标 (`CURSOR`) 的声明、打开、循环、关闭逻辑闭环。<br>2. 数据类型转换 (`_get_column_sql_type`) 准确无误。<br>3. 包含了基本的事务控制 (`START TRANSACTION` ... `COMMIT`)。 |
| **🟡 发展中 (2pt)** | **存在隐患** | 1. 缺少必要的字段判空逻辑。<br>2. 游标循环可能陷入死循环（如缺少 `NOT FOUND` 处理）。<br>3. 字符串拼接存在极少数边缘情况下的注入风险。 |
| **🔴 初始 (1pt)** | **不可用** | 1. 生成的 SQL 包含明显语法错误，无法在 MySQL 执行。<br>2. 逻辑颠倒（如源表和目标表搞反）。 |

## 2. 前端交互：Streamlit (Frontend: Streamlit UI)

此维度关注 `streamlit_app.py` 及其交互体验。

| 评分 | 描述 | 关键特征 (Key Indicators) |
| :--- | :--- | :--- |
| **🟢 卓越 (4pt)** | **原生应用体验** | 1. 巧妙利用 `st.cache_resource` 复用数据库连接，切换页面零延迟。<br>2. 使用 `st.empty()` 或容器占位，避免页面重新渲染时的“跳动”。<br>3. 提供“一键复制 SQL”和“预览/下载”双模输出。 |
| **🔵 达标 (3pt)** | **流畅可用** | 1. **状态管理闭环**：重载页面后，数据库连接和表单填写内容不丢失 (`session_state`)。<br>2. 耗时操作（连接、生成）有明确的 `st.spinner` 提示。<br>3. 异常（如连接超时）通过 `st.error` 优雅展示，不爆红屏。 |
| **🟡 发展中 (2pt)** | **体验生硬** | 1. 每次交互都触发全页面刷新，且数据丢失。<br>2. 缺乏加载提示，用户不知道程序是否卡死。<br>3. 侧边栏配置修改后，主区域内容未正确联动更新。 |
| **🔴 初始 (1pt)** | **阻断性故障** | 1. 点击按钮导致整个应用崩溃（Unhandled Exception）。<br>2. 出现“自杀式”配置允许（如允许源库=目标库且表名相同）。 |

## 3. 工程化与安全 (Engineering & Safety)

此维度关注代码的可维护性、安全防御及打包发布。

| 评分 | 描述 | 关键特征 (Key Indicators) |
| :--- | :--- | :--- |
| **🟢 卓越 (4pt)** | **防御性编程** | 1. **自杀防御机制**：严格的 `check_suicide_risk()` 校验，物理隔离源/目标。<br>2. **打包友好**：代码中处理了 `sys._MEIPASS` 路径，确保 EXE 在任何位置都能运行。<br>3. 敏感信息（如密码）在日志和 UI 中自动脱敏。 |
| **🔵 达标 (3pt)** | **规范合规** | 1. 模块职责清晰（UI 不直接操作 DB，通过 Service 层）。<br>2. 关键函数有 Docstring 说明参数和返回值。<br>3. 依赖管理清晰 (`requirements.txt`)。 |
| **🟡 发展中 (2pt)** | **结构混乱** | 1. 业务逻辑大量堆积在 `streamlit_app.py` 中。<br>2. 硬编码了数据库配置或文件路径。<br>3. 存在未使用的 import 或死代码。 |
| **🔴 初始 (1pt)** | **高危风险** | 1. 包含明文密码或密钥。<br>2. 直接拼接 SQL 字符串而未做任何类型检查。<br>3. 无法通过 PyInstaller 打包。 |

---

## 💡 如何使用本量规

1.  **Code Review**: 在合并代码前，对照上述表格打分。**必须达到 🔵 达标 (3pt) 标准方可合并**。
2.  **Refactoring**: 对于评分为 🟡 或 🔴 的模块，应立即创建 `[TODO]` 任务卡进行重构。
3.  **AI Prompt**: 在生成代码时，可以将本文件的相关章节作为 Context 发送给 AI，要求其“必须符合 🟢 卓越标准”。

